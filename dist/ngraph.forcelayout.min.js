!function(f){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=f();else if("function"==typeof define&&define.amd)define([],f);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).ngraphCreateLayout=f()}}((function(){return function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,(function(r){return o(e[i][1][r]||r)}),p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}({1:[function(require,module,exports){module.exports=function(graph,physicsSettings){if(!graph)throw new Error("Graph structure cannot be undefined");var physicsSimulator=require("ngraph.physics.simulator")(physicsSettings),nodeMass=function(nodeId){var links=graph.getLinks(nodeId);return links?1+links.length/3:1};physicsSettings&&"function"==typeof physicsSettings.nodeMass&&(nodeMass=physicsSettings.nodeMass);var nodeBodies=Object.create(null),springs={},bodiesCount=0,springTransform=physicsSimulator.settings.springTransform||noop;bodiesCount=0,graph.forEachNode((function(node){initBody(node.id),bodiesCount+=1})),graph.forEachLink(initLink),graph.on("changed",onGraphChanged);var wasStable=!1,api={step:function(){if(console.log("change test"),0===bodiesCount)return!0;var lastMove=physicsSimulator.step();api.lastMove=lastMove,api.fire("step");var isStable,isStableNow=lastMove/bodiesCount<=.01;return wasStable!==isStableNow&&(wasStable=isStableNow,isStable=isStableNow,api.fire("stable",isStable)),isStableNow},getNodePosition:function(nodeId){return getInitializedBody(nodeId).pos},setNodePosition:function(nodeId){var body=getInitializedBody(nodeId);body.setPosition.apply(body,Array.prototype.slice.call(arguments,1)),physicsSimulator.invalidateBBox()},getLinkPosition:function(linkId){var spring=springs[linkId];if(spring)return{from:spring.from.pos,to:spring.to.pos}},getGraphRect:function(){return physicsSimulator.getBBox()},forEachBody:function(cb){Object.keys(nodeBodies).forEach((function(bodyId){cb(nodeBodies[bodyId],bodyId)}))},pinNode:function(node,isPinned){getInitializedBody(node.id).isPinned=!!isPinned},isNodePinned:function(node){return getInitializedBody(node.id).isPinned},dispose:function(){graph.off("changed",onGraphChanged),api.fire("disposed")},getBody:function(nodeId){return nodeBodies[nodeId]},getSpring:function(fromId,toId){var linkId;if(void 0===toId)linkId="object"!=typeof fromId?fromId:fromId.id;else{var link=graph.hasLink(fromId,toId);if(!link)return;linkId=link.id}return springs[linkId]},simulator:physicsSimulator,graph:graph,lastMove:0};return eventify(api),api;function onGraphChanged(changes){for(var i=0;i<changes.length;++i){var change=changes[i];"add"===change.changeType?(change.node&&initBody(change.node.id),change.link&&initLink(change.link)):"remove"===change.changeType&&(change.node&&releaseNode(change.node),change.link&&releaseLink(change.link))}bodiesCount=graph.getNodesCount()}function initBody(nodeId){var body=nodeBodies[nodeId];if(!body){var node=graph.getNode(nodeId);if(!node)throw new Error("initBody() was called with unknown node id");var pos=node.position;if(!pos){var neighbors=function(node){var neighbors=[];if(!node.links)return neighbors;for(var maxNeighbors=Math.min(node.links.length,2),i=0;i<maxNeighbors;++i){var link=node.links[i],otherBody=link.fromId!==node.id?nodeBodies[link.fromId]:nodeBodies[link.toId];otherBody&&otherBody.pos&&neighbors.push(otherBody)}return neighbors}(node);pos=physicsSimulator.getBestNewBodyPosition(neighbors)}(body=physicsSimulator.addBodyAt(pos)).id=nodeId,nodeBodies[nodeId]=body,updateBodyMass(nodeId),function(node){return node&&(node.isPinned||node.data&&node.data.isPinned)}(node)&&(body.isPinned=!0)}}function releaseNode(node){var nodeId=node.id,body=nodeBodies[nodeId];body&&(nodeBodies[nodeId]=null,delete nodeBodies[nodeId],physicsSimulator.removeBody(body))}function initLink(link){updateBodyMass(link.fromId),updateBodyMass(link.toId);var fromBody=nodeBodies[link.fromId],toBody=nodeBodies[link.toId],spring=physicsSimulator.addSpring(fromBody,toBody,link.length);springTransform(link,spring),springs[link.id]=spring}function releaseLink(link){var spring=springs[link.id];if(spring){var from=graph.getNode(link.fromId),to=graph.getNode(link.toId);from&&updateBodyMass(from.id),to&&updateBodyMass(to.id),delete springs[link.id],physicsSimulator.removeSpring(spring)}}function updateBodyMass(nodeId){var body=nodeBodies[nodeId];if(body.mass=nodeMass(nodeId),Number.isNaN(body.mass))throw new Error("Node mass should be a number")}function getInitializedBody(nodeId){var body=nodeBodies[nodeId];return body||(initBody(nodeId),body=nodeBodies[nodeId]),body}},module.exports.simulator=require("ngraph.physics.simulator");var eventify=require("ngraph.events");function noop(){}},{"ngraph.events":2,"ngraph.physics.simulator":5}],2:[function(require,module,exports){module.exports=function(subject){!function(subject){if(!subject)throw new Error("Eventify cannot use falsy object as events subject");for(var reservedWords=["on","fire","off"],i=0;i<reservedWords.length;++i)if(subject.hasOwnProperty(reservedWords[i]))throw new Error("Subject cannot be eventified, since it already has property '"+reservedWords[i]+"'")}(subject);var eventsStorage=function(subject){var registeredEvents=Object.create(null);return{on:function(eventName,callback,ctx){if("function"!=typeof callback)throw new Error("callback is expected to be a function");var handlers=registeredEvents[eventName];return handlers||(handlers=registeredEvents[eventName]=[]),handlers.push({callback:callback,ctx:ctx}),subject},off:function(eventName,callback){if(void 0===eventName)return registeredEvents=Object.create(null),subject;if(registeredEvents[eventName])if("function"!=typeof callback)delete registeredEvents[eventName];else for(var callbacks=registeredEvents[eventName],i=0;i<callbacks.length;++i)callbacks[i].callback===callback&&callbacks.splice(i,1);return subject},fire:function(eventName){var fireArguments,callbacks=registeredEvents[eventName];if(!callbacks)return subject;arguments.length>1&&(fireArguments=Array.prototype.splice.call(arguments,1));for(var i=0;i<callbacks.length;++i){var callbackInfo=callbacks[i];callbackInfo.callback.apply(callbackInfo.ctx,fireArguments)}return subject}}}(subject);return subject.on=eventsStorage.on,subject.off=eventsStorage.off,subject.fire=eventsStorage.fire,subject}},{}],3:[function(require,module,exports){function augment(source,target,key){if(source.hasOwnProperty(key)){if("function"==typeof target[key])return;target[key]=function(value){return void 0!==value?(source[key]=value,target):source[key]}}}module.exports=function(settings,target,filter){if("[object Array]"===Object.prototype.toString.call(filter))for(var i=0;i<filter.length;++i)augment(settings,target,filter[i]);else for(var key in settings)augment(settings,target,key)}},{}],4:[function(require,module,exports){function Body(x,y){this.pos=new Vector2d(x,y),this.prevPos=new Vector2d(x,y),this.force=new Vector2d,this.velocity=new Vector2d,this.mass=1}function Vector2d(x,y){x&&"number"!=typeof x?(this.x="number"==typeof x.x?x.x:0,this.y="number"==typeof x.y?x.y:0):(this.x="number"==typeof x?x:0,this.y="number"==typeof y?y:0)}function Body3d(x,y,z){this.pos=new Vector3d(x,y,z),this.prevPos=new Vector3d(x,y,z),this.force=new Vector3d,this.velocity=new Vector3d,this.mass=1}function Vector3d(x,y,z){x&&"number"!=typeof x?(this.x="number"==typeof x.x?x.x:0,this.y="number"==typeof x.y?x.y:0,this.z="number"==typeof x.z?x.z:0):(this.x="number"==typeof x?x:0,this.y="number"==typeof y?y:0,this.z="number"==typeof z?z:0)}module.exports={Body:Body,Vector2d:Vector2d,Body3d:Body3d,Vector3d:Vector3d},Body.prototype.setPosition=function(x,y){this.prevPos.x=this.pos.x=x,this.prevPos.y=this.pos.y=y},Vector2d.prototype.reset=function(){this.x=this.y=0},Body3d.prototype.setPosition=function(x,y,z){this.prevPos.x=this.pos.x=x,this.prevPos.y=this.pos.y=y,this.prevPos.z=this.pos.z=z},Vector3d.prototype.reset=function(){this.x=this.y=this.z=0}},{}],5:[function(require,module,exports){module.exports=function(settings){var Spring=require("./lib/spring"),expose=require("ngraph.expose"),merge=require("ngraph.merge"),eventify=require("ngraph.events"),createQuadTree=(settings=merge(settings,{springLength:30,springCoeff:8e-4,gravity:-1.2,theta:.8,dragCoeff:.02,timeStep:20})).createQuadTree||require("ngraph.quadtreebh"),createBounds=settings.createBounds||require("./lib/bounds"),createDragForce=settings.createDragForce||require("./lib/dragForce"),createSpringForce=settings.createSpringForce||require("./lib/springForce"),integrate=settings.integrator||require("./lib/eulerIntegrator"),createBody=settings.createBody||require("./lib/createBody"),bodies=[],springs=[],quadTree=createQuadTree(settings),bounds=createBounds(bodies,settings),springForce=createSpringForce(settings),dragForce=createDragForce(settings),bboxNeedsUpdate=!0,publicApi={bodies:bodies,quadTree:quadTree,springs:springs,settings:settings,step:function(){!function(){var body,i=bodies.length;if(i)for(quadTree.insertBodies(bodies);i--;)(body=bodies[i]).isPinned||(body.force.reset(),quadTree.updateBodyForce(body),dragForce.update(body));i=springs.length;for(;i--;)springForce.update(springs[i])}();var movement=integrate(bodies,settings.timeStep);return bounds.update(),movement},addBody:function(body){if(!body)throw new Error("Body is required");return bodies.push(body),body},addBodyAt:function(pos){if(!pos)throw new Error("Body position is required");var body=createBody(pos);return bodies.push(body),body},removeBody:function(body){if(body){var idx=bodies.indexOf(body);if(!(idx<0))return bodies.splice(idx,1),0===bodies.length&&bounds.reset(),!0}},addSpring:function(body1,body2,springLength,springWeight,springCoefficient){if(!body1||!body2)throw new Error("Cannot add null spring to force simulator");"number"!=typeof springLength&&(springLength=-1);var spring=new Spring(body1,body2,springLength,springCoefficient>=0?springCoefficient:-1,springWeight);return springs.push(spring),spring},getTotalMovement:function(){return 0},removeSpring:function(spring){if(spring){var idx=springs.indexOf(spring);return idx>-1?(springs.splice(idx,1),!0):void 0}},getBestNewBodyPosition:function(neighbors){return bounds.getBestNewPosition(neighbors)},getBBox:function(){return bboxNeedsUpdate&&(bounds.update(),bboxNeedsUpdate=!1),bounds.box},invalidateBBox:function(){bboxNeedsUpdate=!0},gravity:function(value){return void 0!==value?(settings.gravity=value,quadTree.options({gravity:value}),this):settings.gravity},theta:function(value){return void 0!==value?(settings.theta=value,quadTree.options({theta:value}),this):settings.theta}};return expose(settings,publicApi),eventify(publicApi),publicApi}},{"./lib/bounds":6,"./lib/createBody":7,"./lib/dragForce":8,"./lib/eulerIntegrator":9,"./lib/spring":10,"./lib/springForce":11,"ngraph.events":12,"ngraph.expose":3,"ngraph.merge":13,"ngraph.quadtreebh":14}],6:[function(require,module,exports){module.exports=function(bodies,settings){var random=require("ngraph.random").random(42),boundingBox={x1:0,y1:0,x2:0,y2:0};return{box:boundingBox,update:function(){var i=bodies.length;if(0===i)return;var x1=Number.MAX_VALUE,y1=Number.MAX_VALUE,x2=Number.MIN_VALUE,y2=Number.MIN_VALUE;for(;i--;){var body=bodies[i];body.isPinned?(body.pos.x=body.prevPos.x,body.pos.y=body.prevPos.y):(body.prevPos.x=body.pos.x,body.prevPos.y=body.pos.y),body.pos.x<x1&&(x1=body.pos.x),body.pos.x>x2&&(x2=body.pos.x),body.pos.y<y1&&(y1=body.pos.y),body.pos.y>y2&&(y2=body.pos.y)}boundingBox.x1=x1,boundingBox.x2=x2,boundingBox.y1=y1,boundingBox.y2=y2},reset:function(){boundingBox.x1=boundingBox.y1=0,boundingBox.x2=boundingBox.y2=0},getBestNewPosition:function(neighbors){var graphRect=boundingBox,baseX=0,baseY=0;if(neighbors.length){for(var i=0;i<neighbors.length;++i)baseX+=neighbors[i].pos.x,baseY+=neighbors[i].pos.y;baseX/=neighbors.length,baseY/=neighbors.length}else baseX=(graphRect.x1+graphRect.x2)/2,baseY=(graphRect.y1+graphRect.y2)/2;var springLength=settings.springLength;return{x:baseX+random.next(springLength)-springLength/2,y:baseY+random.next(springLength)-springLength/2}}}}},{"ngraph.random":18}],7:[function(require,module,exports){var physics=require("ngraph.physics.primitives");module.exports=function(pos){return new physics.Body(pos)}},{"ngraph.physics.primitives":4}],8:[function(require,module,exports){module.exports=function(options){var merge=require("ngraph.merge"),api={update:function(body){body.force.x-=options.dragCoeff*body.velocity.x,body.force.y-=options.dragCoeff*body.velocity.y}};return require("ngraph.expose")(options=merge(options,{dragCoeff:.02}),api,["dragCoeff"]),api}},{"ngraph.expose":3,"ngraph.merge":13}],9:[function(require,module,exports){module.exports=function(bodies,timeStep){var i,dx=0,tx=0,dy=0,ty=0,max=bodies.length;if(0===max)return 0;for(i=0;i<max;++i){var body=bodies[i],coeff=timeStep/body.mass;body.velocity.x+=coeff*body.force.x,body.velocity.y+=coeff*body.force.y;var vx=body.velocity.x,vy=body.velocity.y,v=Math.sqrt(vx*vx+vy*vy);v>1&&(body.velocity.x=vx/v,body.velocity.y=vy/v),dx=timeStep*body.velocity.x,dy=timeStep*body.velocity.y,body.pos.x+=dx,body.pos.y+=dy,tx+=Math.abs(dx),ty+=Math.abs(dy)}return(tx*tx+ty*ty)/max}},{}],10:[function(require,module,exports){module.exports=function(fromBody,toBody,length,coeff,weight){this.from=fromBody,this.to=toBody,this.length=length,this.coeff=coeff,this.weight="number"==typeof weight?weight:1}},{}],11:[function(require,module,exports){module.exports=function(options){var merge=require("ngraph.merge"),random=require("ngraph.random").random(42),api={update:function(spring){var body1=spring.from,body2=spring.to,length=spring.length<0?options.springLength:spring.length,dx=body2.pos.x-body1.pos.x,dy=body2.pos.y-body1.pos.y,r=Math.sqrt(dx*dx+dy*dy);0===r&&(dx=(random.nextDouble()-.5)/50,dy=(random.nextDouble()-.5)/50,r=Math.sqrt(dx*dx+dy*dy));var d=r-length,coeff=(!spring.coeff||spring.coeff<0?options.springCoeff:spring.coeff)*d/r*spring.weight;body1.force.x+=coeff*dx,body1.force.y+=coeff*dy,body2.force.x-=coeff*dx,body2.force.y-=coeff*dy}};return require("ngraph.expose")(options=merge(options,{springCoeff:2e-4,springLength:80}),api,["springCoeff","springLength"]),api}},{"ngraph.expose":3,"ngraph.merge":13,"ngraph.random":18}],12:[function(require,module,exports){arguments[4][2][0].apply(exports,arguments)},{dup:2}],13:[function(require,module,exports){module.exports=function merge(target,options){var key;target||(target={});if(options)for(key in options)if(options.hasOwnProperty(key)){var targetHasIt=target.hasOwnProperty(key),optionsValueType=typeof options[key];!targetHasIt||typeof target[key]!==optionsValueType?target[key]=options[key]:"object"===optionsValueType&&(target[key]=merge(target[key],options[key]))}return target}},{}],14:[function(require,module,exports){function getChild(node,idx){return 0===idx?node.quad0:1===idx?node.quad1:2===idx?node.quad2:3===idx?node.quad3:null}function setChild(node,idx,child){0===idx?node.quad0=child:1===idx?node.quad1=child:2===idx?node.quad2=child:3===idx&&(node.quad3=child)}module.exports=function(options){(options=options||{}).gravity="number"==typeof options.gravity?options.gravity:-1,options.theta="number"==typeof options.theta?options.theta:.8;var random=require("ngraph.random").random(1984),Node=require("./node"),InsertStack=require("./insertStack"),isSamePosition=require("./isSamePosition"),gravity=options.gravity,updateQueue=[],insertStack=new InsertStack,theta=options.theta,nodesCache=[],currentInCache=0,root=newNode();return{insertBodies:function(bodies){var i,x1=Number.MAX_VALUE,y1=Number.MAX_VALUE,x2=Number.MIN_VALUE,y2=Number.MIN_VALUE,max=bodies.length;i=max;for(;i--;){var x=bodies[i].pos.x,y=bodies[i].pos.y;x<x1&&(x1=x),x>x2&&(x2=x),y<y1&&(y1=y),y>y2&&(y2=y)}var dx=x2-x1,dy=y2-y1;dx>dy?y2=y1+dx:x2=x1+dy;currentInCache=0,(root=newNode()).left=x1,root.right=x2,root.top=y1,root.bottom=y2,(i=max-1)>=0&&(root.body=bodies[i]);for(;i--;)insert(bodies[i])},getRoot:function(){return root},updateBodyForce:function(sourceBody){var v,dx,dy,r,queue=updateQueue,fx=0,fy=0,queueLength=1,shiftIdx=0,pushIdx=1;queue[0]=root;for(;queueLength;){var node=queue[shiftIdx],body=node.body;queueLength-=1,shiftIdx+=1;var differentBody=body!==sourceBody;body&&differentBody?(dx=body.pos.x-sourceBody.pos.x,dy=body.pos.y-sourceBody.pos.y,0===(r=Math.sqrt(dx*dx+dy*dy))&&(dx=(random.nextDouble()-.5)/50,dy=(random.nextDouble()-.5)/50,r=Math.sqrt(dx*dx+dy*dy)),fx+=(v=gravity*body.mass*sourceBody.mass/(r*r*r))*dx,fy+=v*dy):differentBody&&(dx=node.massX/node.mass-sourceBody.pos.x,dy=node.massY/node.mass-sourceBody.pos.y,0===(r=Math.sqrt(dx*dx+dy*dy))&&(dx=(random.nextDouble()-.5)/50,dy=(random.nextDouble()-.5)/50,r=Math.sqrt(dx*dx+dy*dy)),(node.right-node.left)/r<theta?(fx+=(v=gravity*node.mass*sourceBody.mass/(r*r*r))*dx,fy+=v*dy):(node.quad0&&(queue[pushIdx]=node.quad0,queueLength+=1,pushIdx+=1),node.quad1&&(queue[pushIdx]=node.quad1,queueLength+=1,pushIdx+=1),node.quad2&&(queue[pushIdx]=node.quad2,queueLength+=1,pushIdx+=1),node.quad3&&(queue[pushIdx]=node.quad3,queueLength+=1,pushIdx+=1)))}sourceBody.force.x+=fx,sourceBody.force.y+=fy},options:function(newOptions){return newOptions?("number"==typeof newOptions.gravity&&(gravity=newOptions.gravity),"number"==typeof newOptions.theta&&(theta=newOptions.theta),this):{gravity:gravity,theta:theta}}};function newNode(){var node=nodesCache[currentInCache];return node?(node.quad0=null,node.quad1=null,node.quad2=null,node.quad3=null,node.body=null,node.mass=node.massX=node.massY=0,node.left=node.right=node.top=node.bottom=0):(node=new Node,nodesCache[currentInCache]=node),++currentInCache,node}function insert(newBody){for(insertStack.reset(),insertStack.push(root,newBody);!insertStack.isEmpty();){var stackItem=insertStack.pop(),node=stackItem.node,body=stackItem.body;if(node.body){var oldBody=node.body;if(node.body=null,isSamePosition(oldBody.pos,body.pos)){var retriesCount=3;do{var offset=random.nextDouble(),dx=(node.right-node.left)*offset,dy=(node.bottom-node.top)*offset;oldBody.pos.x=node.left+dx,oldBody.pos.y=node.top+dy,retriesCount-=1}while(retriesCount>0&&isSamePosition(oldBody.pos,body.pos));if(0===retriesCount&&isSamePosition(oldBody.pos,body.pos))return}insertStack.push(node,oldBody),insertStack.push(node,body)}else{var x=body.pos.x,y=body.pos.y;node.mass=node.mass+body.mass,node.massX=node.massX+body.mass*x,node.massY=node.massY+body.mass*y;var quadIdx=0,left=node.left,right=(node.right+left)/2,top=node.top,bottom=(node.bottom+top)/2;x>right&&(quadIdx+=1,left=right,right=node.right),y>bottom&&(quadIdx+=2,top=bottom,bottom=node.bottom);var child=getChild(node,quadIdx);child?insertStack.push(child,body):((child=newNode()).left=left,child.top=top,child.right=right,child.bottom=bottom,child.body=body,setChild(node,quadIdx,child))}}}}},{"./insertStack":15,"./isSamePosition":16,"./node":17,"ngraph.random":18}],15:[function(require,module,exports){function InsertStack(){this.stack=[],this.popIdx=0}function InsertStackElement(node,body){this.node=node,this.body=body}module.exports=InsertStack,InsertStack.prototype={isEmpty:function(){return 0===this.popIdx},push:function(node,body){var item=this.stack[this.popIdx];item?(item.node=node,item.body=body):this.stack[this.popIdx]=new InsertStackElement(node,body),++this.popIdx},pop:function(){if(this.popIdx>0)return this.stack[--this.popIdx]},reset:function(){this.popIdx=0}}},{}],16:[function(require,module,exports){module.exports=function(point1,point2){var dx=Math.abs(point1.x-point2.x),dy=Math.abs(point1.y-point2.y);return dx<1e-8&&dy<1e-8}},{}],17:[function(require,module,exports){module.exports=function(){this.body=null,this.quad0=null,this.quad1=null,this.quad2=null,this.quad3=null,this.mass=0,this.massX=0,this.massY=0,this.left=0,this.top=0,this.bottom=0,this.right=0}},{}],18:[function(require,module,exports){function random(inputSeed){var seed="number"==typeof inputSeed?inputSeed:+new Date,randomFunc=function(){return(268435455&(seed=4294967295&(3042594569^(seed=(seed=4294967295&((seed=(seed=4294967295&(3345072700^(seed=seed+2127912214+(seed<<12)&4294967295)^seed>>>19))+374761393+(seed<<5)&4294967295)+3550635116^seed<<9))+4251993797+(seed<<3)&4294967295)^seed>>>16)))/268435456};return{next:function(maxValue){return Math.floor(randomFunc()*maxValue)},nextDouble:function(){return randomFunc()}}}module.exports={random:random,randomIterator:function(array,customRandom){var localRandom=customRandom||random();if("function"!=typeof localRandom.next)throw new Error("customRandom does not match expected API: next() function is missing");return{forEach:function(callback){var i,j,t;for(i=array.length-1;i>0;--i)j=localRandom.next(i+1),t=array[j],array[j]=array[i],array[i]=t,callback(t);array.length&&callback(array[0])},shuffle:function(){var i,j,t;for(i=array.length-1;i>0;--i)j=localRandom.next(i+1),t=array[j],array[j]=array[i],array[i]=t;return array}}}}},{}]},{},[1])(1)}));